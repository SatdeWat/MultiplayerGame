<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zeeslag - Home</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <h1>⚓ Zeeslag - Home ⚓</h1>
  <button id="createLobbyBtn">Maak Lobby</button>
  <button id="joinLobbyBtn">Join Lobby</button>
  <button id="leaderboardBtn">Leaderboard</button>
  <button id="logoutBtn">Logout</button>

  <div id="createLobbySection" style="display:none;">
    <h3>Kies gamemode en bord grootte</h3>
    <button class="modeBtn" data-mode="classic">Classic</button>
    <button class="modeBtn" data-mode="streak">Streak</button>
    <button class="modeBtn" data-mode="power">Power</button>
    <div id="sizeSelection"></div>
  </div>

  <div id="joinLobbySection" style="display:none;">
    <h3>Voer Lobby Code in</h3>
    <input type="text" id="lobbyCodeInput" placeholder="Lobby Code">
    <button id="joinLobbyConfirmBtn">Join</button>
  </div>
</div>

<script type="module">
import { db, ref, set, get } from "./firebase.js";

const username = localStorage.getItem("username");
const isGuest = localStorage.getItem("isGuest") === "true";
if(!username) window.location.href="index.html";

const createLobbyBtn = document.getElementById("createLobbyBtn");
const joinLobbyBtn = document.getElementById("joinLobbyBtn");
const leaderboardBtn = document.getElementById("leaderboardBtn");
const logoutBtn = document.getElementById("logoutBtn");

const createLobbySection = document.getElementById("createLobbySection");
const joinLobbySection = document.getElementById("joinLobbySection");

const sizeSelection = document.getElementById("sizeSelection");
const lobbyCodeInput = document.getElementById("lobbyCodeInput");
const joinLobbyConfirmBtn = document.getElementById("joinLobbyConfirmBtn");

// --- Knoppen ---
createLobbyBtn.addEventListener("click", ()=>{
  createLobbySection.style.display="block";
  joinLobbySection.style.display="none";
});

joinLobbyBtn.addEventListener("click", ()=>{
  createLobbySection.style.display="none";
  joinLobbySection.style.display="block";
});

logoutBtn.addEventListener("click", ()=>{
  localStorage.clear();
  window.location.href="index.html";
});

// --- Gamemode knoppen ---
document.querySelectorAll(".modeBtn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const mode = btn.dataset.mode;
    sizeSelection.innerHTML="";
    let sizes=[];
    if(mode==="classic") sizes=[{size:10,ships:3}];
    if(mode==="streak") sizes=[{size:15,ships:4}];
    if(mode==="power") sizes=[{size:20,ships:6}];

    sizes.forEach(s=>{
      const b=document.createElement("button");
      b.textContent=`${s.size}x${s.size} (${s.ships} schepen)`;
      b.classList.add("sizeBtn");
      b.addEventListener("click", async ()=>{
        const code=Math.random().toString(36).substring(2,7).toUpperCase();
        await set(ref(db,"lobbies/"+code),{
          host: username,
          guest:"",
          mode:mode,
          size:s.size,
          ships:s.ships
        });
        localStorage.setItem("lobbyCode",code);
        window.location.href="game.html";
      });
      sizeSelection.appendChild(b);
    });
  });
});

// --- Join Lobby ---
joinLobbyConfirmBtn.addEventListener("click", async ()=>{
  const code = lobbyCodeInput.value.trim().toUpperCase();
  const lobbyRef = ref(db,"lobbies/"+code);
  const snap = await get(lobbyRef);
  if(!snap.exists()){ alert("Lobby niet gevonden!"); return; }
  const data = snap.val();
  if(data.guest){ alert("Lobby vol!"); return; }

  await set(ref(db,"lobbies/"+code+"/guest"), username);
  localStorage.setItem("lobbyCode",code);
  window.location.href="game.html";
});
</script>
</body>
</html>
