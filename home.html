<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Zeeslag - Home</title>
<link rel="stylesheet" href="style.css">
<style>
  /* extra style alleen voor mooiere lobbycode invoer */
  #joinLobbySection {
    display: none;
    text-align: center;
  }
  .lobby-input-wrap {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-top: 14px;
  }
  #lobbyCodeInput {
    width: 180px;
    padding: 12px 14px;
    border-radius: 12px;
    border: none;
    background: rgba(255,255,255,0.08);
    color: #fff;
    text-align: center;
    font-size: 16px;
    letter-spacing: 2px;
    font-weight: 600;
    outline: none;
    transition: 0.2s ease;
  }
  #lobbyCodeInput:focus {
    background: rgba(255,255,255,0.15);
    box-shadow: 0 0 12px rgba(0,170,255,0.5);
  }
</style>
</head>
<body>
<div class="container">
  <h1>⚓ Zeeslag - Home ⚓</h1>

  <div class="controls">
    <button id="createLobbyBtn">Maak Lobby</button>
    <button id="joinLobbyBtn">Join Lobby</button>
    <button id="leaderboardBtn">Leaderboard</button>
    <button id="logoutBtn" class="secondary">Logout</button>
  </div>

  <div id="createLobbySection" style="display:none; margin-top:16px;">
    <h3>Kies gamemode</h3>
    <div class="mode-grid">
      <button class="modeBtn" data-mode="classic">Classic</button>
      <button class="modeBtn" data-mode="streak">Streak</button>
      <button class="modeBtn" data-mode="power">Power</button>
    </div>

    <div id="sizeSelection" style="margin-top:12px;"></div>
  </div>

  <div id="joinLobbySection">
    <h3 style="margin-top:20px;">Voer lobbycode in</h3>
    <div class="lobby-input-wrap">
      <input id="lobbyCodeInput" placeholder="ABCDE" maxlength="5" />
      <button id="joinConfirmBtn">Join</button>
    </div>
    <p class="msg">Vul de code van je vriend in om te joinen.</p>
  </div>

</div>

<script type="module">
import { db, dbRef as ref, dbSet as set, dbGet as get, dbUpdate as update } from "./firebase.js";

const username = localStorage.getItem("username");
if(!username) window.location.href="index.html";

const createLobbyBtn = document.getElementById("createLobbyBtn");
const joinLobbyBtn = document.getElementById("joinLobbyBtn");
const leaderboardBtn = document.getElementById("leaderboardBtn");
const logoutBtn = document.getElementById("logoutBtn");
const createLobbySection = document.getElementById("createLobbySection");
const joinLobbySection = document.getElementById("joinLobbySection");
const sizeSelection = document.getElementById("sizeSelection");
const lobbyCodeInput = document.getElementById("lobbyCodeInput");
const joinConfirmBtn = document.getElementById("joinConfirmBtn");

createLobbyBtn.addEventListener("click", ()=>{
  createLobbySection.style.display = "block";
  joinLobbySection.style.display = "none";
});
joinLobbyBtn.addEventListener("click", ()=>{
  createLobbySection.style.display = "none";
  joinLobbySection.style.display = "block";
  lobbyCodeInput.focus();
});
logoutBtn.addEventListener("click", ()=>{
  localStorage.clear();
  window.location.href="index.html";
});
leaderboardBtn.addEventListener("click", ()=> location.href="leaderboard.html");

document.querySelectorAll(".modeBtn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const mode = btn.dataset.mode;
    sizeSelection.innerHTML = "";
    const sizes = [{size:10,ships:3},{size:15,ships:4},{size:20,ships:6}];
    sizes.forEach(s=>{
      const b = document.createElement("button");
      b.textContent = `${s.size}x${s.size} — ${s.ships} schepen`;
      b.className = "secondary";
      b.style.margin = "6px";
      b.addEventListener("click", async ()=>{
        const code = Math.random().toString(36).substring(2,7).toUpperCase();
        await set(ref(db, "lobbies/" + code), {
          host: username,
          guest: "",
          mode: mode,
          size: s.size,
          ships: s.ships,
          ready: {}
        });
        localStorage.setItem("lobbyCode", code);
        window.location.href = "lobby.html";
      });
      sizeSelection.appendChild(b);
    });
  });
});

joinConfirmBtn.addEventListener("click", async ()=>{
  const code = (lobbyCodeInput.value || "").trim().toUpperCase();
  if(!code) return alert("Voer een lobbycode in.");
  const snap = await get(ref(db, "lobbies/" + code));
  if(!snap.exists()) return alert("Lobby niet gevonden.");
  const data = snap.val();
  if(data.guest) return alert("Lobby is al vol.");
  await update(ref(db,"lobbies/"+code), { guest: username });
  localStorage.setItem("lobbyCode", code);
  window.location.href = "lobby.html";
});
</script>
</body>
</html>
