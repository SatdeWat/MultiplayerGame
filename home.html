<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Zeeslag — Home</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<main class="wrap">
  <div class="topbar">
    <div><h1>Zeeslag</h1><div class="muted">Kies wat je wilt doen</div></div>
    <div id="profile-info" class="muted"></div>
  </div>

  <section class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h3 id="profile-username">—</h3>
        <div id="profile-uid" class="muted"></div>
      </div>
      <div style="display:flex;gap:8px">
        <button id="btn-join-lobby">Join Lobby</button>
        <button id="btn-gamemodes">Gamemodes</button>
        <button id="btn-leaderboard">Leaderboard</button>
        <button id="btn-tutorial">How to play</button>
        <button id="btn-logout" class="ghost">Logout</button>
      </div>
    </div>
  </section>

  <section class="card hidden" id="gamemode-list">
    <h3>Gamemodes (maak lobby)</h3>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px">
      <div>
        <h4>Classic</h4>
        <div class="muted">Kies 10×10 / 15×15 / 20×20. Schepen: 10→3, 15→4, 20→6.</div>
        <div class="row" style="margin-top:8px">
          <select id="gm-classic-size">
            <option value="10">10×10 — 3 schepen</option>
            <option value="15" selected>15×15 — 4 schepen</option>
            <option value="20">20×20 — 6 schepen</option>
          </select>
          <button id="btn-classic-create">Create</button>
        </div>
      </div>

      <div>
        <h4>Power</h4>
        <div class="muted">20×20. Sink ship → +1 powershot (3×3).</div>
        <div style="margin-top:8px"><button id="btn-power-create">Create Power (20×20)</button></div>
      </div>

      <div>
        <h4>Streak</h4>
        <div class="muted">Hit → nog een beurt. Kies 10/15/20 — scheepstallen zoals hierboven.</div>
        <div class="row" style="margin-top:8px">
          <select id="gm-streak-size">
            <option value="10">10×10 — 3 schepen</option>
            <option value="15" selected>15×15 — 4 schepen</option>
            <option value="20">20×20 — 6 schepen</option>
          </select>
          <button id="btn-streak-create">Create</button>
        </div>
      </div>
      
</main>

<script type="module">
import { loadLocalProfile } from "./app-auth.js";
import { db } from "./firebase-config.js";
import { ref, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const $ = id => document.getElementById(id);
document.addEventListener('DOMContentLoaded', ()=>{
  const profile = loadLocalProfile();
  if (!profile) { location.href='index.html'; return; }
  $('profile-username').textContent = profile.username + (profile.guest ? ' (Gast)':'');
  $('profile-uid').textContent = profile.uid;

  $('btn-logout').addEventListener('click', ()=> { localStorage.removeItem('zs_profile_v2'); location.href='index.html'; });
  $('btn-join-lobby').addEventListener('click', ()=> location.href='lobby.html');
  $('btn-leaderboard').addEventListener('click', ()=> location.href='leaderboard.html');
  $('btn-gamemodes').addEventListener('click', ()=> $('gamemode-list').classList.toggle('hidden'));
  $('btn-back-menu').addEventListener('click', ()=> $('gamemode-list').classList.add('hidden'));

  function makeCode(len=6){ const chars="ABCDEFGHJKMNPQRSTUVWXYZ23456789"; let s=""; for(let i=0;i<len;i++) s+=chars[Math.floor(Math.random()*chars.length)]; return s; }

  async function createLobby(gamemode,size){
    const uid = profile.uid;
    const code = makeCode(6);
    const gameId = `game_${Date.now()}_${Math.floor(Math.random()*9999)}`;
    const players = {}; players[uid] = { username: profile.username, ready:false, slot:0 };
    // default ship sets will be applied in game_core based on size
    await set(ref(db, `lobbies/${code}`), { gameId, owner: uid, gamemode, size });
    await set(ref(db, `games/${gameId}`), { players, status: "waiting", gamemode, size, createdAt: Date.now() });
    location.href = `lobby.html?code=${code}`;
  }

  $('btn-classic-create').addEventListener('click', ()=> createLobby('classic', parseInt($('gm-classic-size').value,10)));
  $('btn-power-create').addEventListener('click', ()=> createLobby('power', 20));
  $('btn-streak-create').addEventListener('click', ()=> createLobby('streak', parseInt($('gm-streak-size').value,10)));
  $('btn-salvo-create').addEventListener('click', ()=> createLobby('salvo', 15));
});
</script>
</body>
</html>
