<!-- lobby.html -->
<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <title>Lobby</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <div class="title">Lobby</div>
        <div style="color:rgba(232,246,255,0.7)">Wacht op tweede speler — lobby details hieronder</div>
      </div>
      <div class="flex">
        <div id="playerLabel" style="font-weight:800;color:var(--accent)"></div>
        <button id="btnBack" class="btn ghost small">Home</button>
      </div>
    </div>

    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:900;font-size:20px">Lobby code: <span id="lobbyCodeShow" style="color:var(--accent2)"></span></div>
          <div id="lobbyInfo" style="color:rgba(232,246,255,0.7)"></div>
        </div>
        <div style="text-align:right">
          <div id="playersList"></div>
          <div id="statusLabel" style="margin-top:8px;color:var(--accent)"></div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { db, dbRef, dbGet, dbOnValue, dbSet } from './firebase.js';

    const player = localStorage.getItem('player');
    const lobbyCode = localStorage.getItem('lobbyCode');
    if(!lobbyCode) { alert('Geen lobby gevonden'); location.href='index.html'; }
    document.getElementById('playerLabel').textContent = player || 'Gast';
    document.getElementById('lobbyCodeShow').textContent = lobbyCode;

    document.getElementById('btnBack').addEventListener('click', ()=> location.href='index.html');

    const ref = dbRef(db, 'lobbies/' + lobbyCode);
    dbOnValue(ref, (snap)=>{
      if(!snap.exists()) return;
      const data = snap.val();
      lobbyInfo.textContent = `Mode: ${data.mode} · Bord: ${data.size}×${data.size} · Schepen: ${data.shipSet ? data.shipSet.join(',') : 'n.v.t.'}`;
      const players = data.players || {};
      playersList.innerHTML = `<div><strong>Host:</strong> ${players.host || '-'}</div><div><strong>Guest:</strong> ${players.guest || '-'}</div>`;
      statusLabel.textContent = data.status || 'waiting';
      // if both players present -> send both to place-ships
      if(players.host && players.guest){
        // ensure both know the lobbyCode (already set in localStorage)
        // set status ready -> players will be redirected to place-ships
        if(data.status === 'waiting' || data.status === 'ready') {
          dbSet(dbRef(db, `lobbies/${lobbyCode}/status`), 'players_ready');
        }
        // redirect after short delay
        setTimeout(()=> location.href='place-ships.html', 800);
      }
    });
  </script>
</body>
</html>
