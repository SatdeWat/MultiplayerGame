<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zeeslag — Login</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <main class="wrap">
    <header class="topbar"><h1>Zeeslag</h1><p class="subtitle">Login of speel als gast</p></header>

    <section class="card" id="auth-card">
      <h2>Login / Registreren</h2>
      <div class="form-grid">
        <label>Gebruikersnaam <input id="username" placeholder="gebruikersnaam" autocomplete="off"></label>
        <label>Pincode <input id="pincode" placeholder="4–8 tekens" type="password" maxlength="8" autocomplete="off"></label>
      </div>
      <div class="row" style="margin-top:8px">
        <button id="btn-register">Registreren</button>
        <button id="btn-login">Inloggen</button>
        <button id="btn-guest">Speel als gast</button>
      </div>
      <div id="auth-status" class="muted" style="margin-top:12px"></div>
    </section>
  </main>

  <!-- script onderaan, en wacht op DOMContentLoaded -->
  <script type="module">
    import { registerUser, loginUser, loginGuest } from "./app-auth.js";

    const $ = id => document.getElementById(id);

    document.addEventListener('DOMContentLoaded', ()=> {
      const status = $("auth-status");
      const inUser = $("username");
      const inPin = $("pincode");
      const btnRegister = $("btn-register");
      const btnLogin = $("btn-login");
      const btnGuest = $("btn-guest");

      // helper: safe set status
      function setStatus(msg, isError=false){
        status.textContent = msg;
        status.style.color = isError ? "#ffb4b4" : "";
      }

      btnRegister.addEventListener('click', async ()=>{
        setStatus("Registreren...");
        try {
          const u = inUser.value.trim();
          const p = inPin.value.trim();
          if (!u || !p) { setStatus("Vul gebruikersnaam en pincode in", true); return; }
          await registerUser(u, p); // throws on error
          setStatus("Geregistreerd — doorsturen naar lobby...");
          setTimeout(()=> location.href = "lobby.html", 350);
        } catch(err){
          console.error("register error", err);
          setStatus("Registratie mislukt: " + (err.message || err), true);
        }
      });

      btnLogin.addEventListener('click', async ()=>{
        setStatus("Inloggen...");
        try {
          const u = inUser.value.trim();
          const p = inPin.value.trim();
          if (!u || !p) { setStatus("Vul gebruikersnaam en pincode in", true); return; }
          await loginUser(u, p); // throws if not found
          setStatus("Ingelogd — doorsturen naar lobby...");
          setTimeout(()=> location.href = "lobby.html", 250);
        } catch(err){
          console.error("login error", err);
          setStatus("Login mislukt: " + (err.message || err), true);
        }
      });

      btnGuest.addEventListener('click', ()=>{
        try {
          loginGuest();
          setStatus("Ingelogd als gast — doorsturen naar lobby...");
          setTimeout(()=> location.href = "lobby.html", 200);
        } catch(err){
          console.error("guest error", err);
          setStatus("Kon niet als gast inloggen: " + (err.message || err), true);
        }
      });

      // usability: press Enter on pincode to attempt login
      inPin.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter') btnLogin.click();
      });
    });
  </script>
</body>
</html>
