<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zeeslag - Login</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <h1>⚓ Zeeslag ⚓</h1>
  
  <div id="loginSection">
    <input type="text" id="usernameInput" placeholder="Gebruikersnaam">
    <input type="password" id="passwordInput" placeholder="Wachtwoord">
    <button id="loginBtn">Login</button>
    <button id="registerBtn">Register</button>
    <button id="guestBtn">Speel als gast</button>
    <p id="loginMessage"></p>
  </div>
</div>

<script type="module">
import { db, ref, get, set } from "./firebase.js";

const usernameInput = document.getElementById("usernameInput");
const passwordInput = document.getElementById("passwordInput");
const loginBtn = document.getElementById("loginBtn");
const registerBtn = document.getElementById("registerBtn");
const guestBtn = document.getElementById("guestBtn");
const loginMessage = document.getElementById("loginMessage");

// --- Login ---
loginBtn.addEventListener("click", async ()=>{
  const username = usernameInput.value.trim();
  const password = passwordInput.value.trim();
  if(!username || !password){ loginMessage.textContent="Vul alle velden in!"; return; }

  const userRef = ref(db,"users/"+username);
  const snap = await get(userRef);
  if(!snap.exists()){ loginMessage.textContent="Gebruiker bestaat niet!"; return; }
  const data = snap.val();
  if(data.password !== password){ loginMessage.textContent="Verkeerd wachtwoord!"; return; }

  localStorage.setItem("username", username);
  localStorage.setItem("isGuest", "false");
  window.location.href="home.html";
});

// --- Register ---
registerBtn.addEventListener("click", async ()=>{
  const username = usernameInput.value.trim();
  const password = passwordInput.value.trim();
  if(!username || !password){ loginMessage.textContent="Vul alle velden in!"; return; }

  const userRef = ref(db,"users/"+username);
  const snap = await get(userRef);
  if(snap.exists()){ loginMessage.textContent="Gebruiker bestaat al!"; return; }

  await set(userRef, {password: password, wins:0, games:0});
  localStorage.setItem("username", username);
  localStorage.setItem("isGuest", "false");
  window.location.href="home.html";
});

// --- Speel als gast ---
guestBtn.addEventListener("click", ()=>{
  const guestName = prompt("Vul een tijdelijke naam in:");
  if(!guestName) return;
  localStorage.setItem("username", guestName);
  localStorage.setItem("isGuest", "true");
  window.location.href="home.html";
});
</script>
</body>
</html>
